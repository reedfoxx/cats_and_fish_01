<!doctype html>
<html lang="uk">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>–ö–æ—Ç–∏–∫ –ª–æ–≤–∏—Ç—å —Ä–∏–±—É ‚Äî –∑–∞–¥–∞—á—ñ –¥–ª—è 1‚Äì9 –∫–ª–∞—Å—ñ–≤</title>
<style>
  :root{
    --bg-top:#e8f6ff;
    --bg:#f6fbff;
    --card:#ffffff;
    --accent:#3b82f6;
    --accent-2:#ffb74d;
    --muted:#6b7785;
    --text:#12323b;
    --success:#0b9b46;
    --danger:#c0392b;
    --glass: rgba(20,40,60,0.04);
  }
  *{box-sizing:border-box}
  body{
    margin:0;
    font-family: Inter, "Segoe UI", Roboto, Arial, sans-serif;
    background: linear-gradient(180deg,var(--bg-top) 0%, var(--bg) 100%);
    color:var(--text);
    display:flex;
    align-items:flex-start;
    justify-content:center;
    min-height:100vh;
    padding:28px;
  }
  .app{
    width:100%;
    max-width:1100px;
  }
  header{
    display:flex;
    align-items:center;
    justify-content:space-between;
    gap:16px;
    margin-bottom:18px;
  }
  .title-block{
    display:flex;
    gap:14px;
    align-items:center;
  }
  .logo{
    width:64px;height:64px;border-radius:14px;
    background:linear-gradient(135deg,var(--accent),#2563eb);
    display:flex;align-items:center;justify-content:center;color:white;font-size:30px;
    box-shadow:0 8px 30px rgba(37,99,235,0.12);
  }
  .title{
    font-size:20px;
    font-weight:800;
    line-height:1;
  }
  .subtitle{ color:var(--muted); font-size:13px; margin-top:6px; }
  .controls{ display:flex; gap:8px; align-items:center; flex-wrap:wrap; }
  .levels{
    display:flex;
    gap:8px;
    margin-bottom:12px;
    flex-wrap:wrap;
  }
  .btn{
    padding:8px 14px;
    background:var(--card);
    border-radius:10px;
    border:1px solid var(--glass);
    cursor:pointer;
    box-shadow:0 2px 8px rgba(16,24,40,0.03);
    font-weight:700;
    color:var(--text);
    font-size:14px;
  }
  .btn.active{
    background:linear-gradient(180deg,var(--accent),#2563eb);
    color:white;
    box-shadow:0 8px 26px rgba(37,99,235,0.18);
    border: none;
  }
  main{
    display:grid;
    grid-template-columns: 1fr 360px;
    gap:18px;
    align-items:start;
  }
  .card{
    background:var(--card);
    border-radius:14px;
    padding:16px;
    box-shadow:0 10px 30px rgba(16,24,40,0.06);
  }
  .task{
    margin-bottom:14px;
    padding:12px;
    border-radius:10px;
    border:1px dashed rgba(16,24,40,0.03);
    background:linear-gradient(180deg, rgba(59,130,246,0.03), transparent);
  }
  .task h3{ margin:0 0 8px 0; font-size:15px; display:flex; justify-content:space-between; align-items:center; gap:10px; }
  .task p{ margin:0 0 8px 0; color:var(--text); opacity:.95; }
  input[type="text"], input[type="number"], select, textarea{
    width:100%;
    box-sizing:border-box;
    padding:10px 12px;
    border-radius:10px;
    border:1px solid rgba(20,40,60,.08);
    margin-bottom:8px;
    font-size:14px;
    color:var(--text);
  }
  .check{
    display:inline-block;
    padding:10px 14px;
    border-radius:10px;
    background:var(--accent);
    color:white;
    cursor:pointer;
    border:none;
    font-weight:800;
    letter-spacing:.2px;
  }
  .hint{ font-size:13px; color:var(--muted); opacity:.95; margin-top:6px; }
  .result{
    margin-top:8px;
    font-weight:700;
    min-height:22px;
    font-size:14px;
  }
  .right{ color:var(--success); display:inline-flex; gap:8px; align-items:center; }
  .wrong{ color:var(--danger); display:inline-flex; gap:8px; align-items:center; }

  /* sidebar - cat & fish */
  .sidebar{
    position:relative;
    display:flex;
    flex-direction:column;
    gap:12px;
    align-items:center;
  }
  .cat-box{
    width:320px;
    height:240px;
    border-radius:14px;
    background:linear-gradient(180deg,#fff 0,#f5fbff 100%);
    display:flex;
    justify-content:center;
    align-items:center;
    position:relative;
    overflow:hidden;
    border:1px solid rgba(20,40,60,.04);
  }
  .cat{
    font-size:72px;
    transform:translateY(8px);
    transition:transform .25s ease;
    filter: drop-shadow(0 6px 14px rgba(0,0,0,0.06));
  }
  .fish-pool{
    position:absolute;
    bottom:14px;
    left:14px;
    right:14px;
    height:68px;
    display:flex;
    align-items:center;
    gap:8px;
    padding:8px;
  }
  .fish{
    font-size:30px;
    transform-origin:center;
    transition:transform .2s ease;
    cursor:pointer;
  }
  .fish.fly{
    animation:flyToCat 900ms cubic-bezier(.2,.9,.3,1) forwards;
  }
  @keyframes flyToCat{
    0%{ transform: translate(0,0) scale(1) rotate(0deg); opacity:1; }
    60%{ transform: translate(-80px,-120px) scale(1.05) rotate(-6deg); opacity:1; }
    100%{ transform: translate(-160px,-220px) scale(.55) rotate(-22deg); opacity:0; }
  }
  .fish-count{
    display:flex;
    gap:8px;
    align-items:center;
    background:linear-gradient(180deg,#fff,#f7fbff);
    padding:10px 14px;
    border-radius:999px;
    border:1px solid rgba(20,40,60,.06);
    font-weight:800;
    font-size:15px;
  }
  .note{ font-size:13px; color:var(--muted); opacity:.95; text-align:center; padding:6px 8px; }

  .level-header{ display:flex; justify-content:space-between; align-items:center; gap:12px; margin-bottom:8px; }
  .small-muted{ color:var(--muted); font-size:13px; }

  /* responsive */
  @media (max-width:980px){
    main{ grid-template-columns: 1fr; }
    .sidebar{ flex-direction:row; justify-content:space-between; padding:8px 4px; }
    .cat-box{ width:100%; height:160px; }
    .fish-pool{ bottom:8px; height:54px; }
  }
</style>
</head>
<body>
<div class="app">
  <header>
    <div class="title-block">
      <div class="logo" aria-hidden="true">üê±</div>
      <div>
        <div class="title">–ö–æ—Ç–∏–∫ –ª–æ–≤–∏—Ç—å —Ä–∏–±—É ‚Äî –≤–ø—Ä–∞–≤–∏ –¥–ª—è 1‚Äì9 –∫–ª–∞—Å—ñ–≤</div>
        <div class="subtitle">–í–∏–±–µ—Ä–∏ —Ä—ñ–≤–µ–Ω—å. –ó–∞ –∫–æ–∂–Ω—É –ø—Ä–∞–≤–∏–ª—å–Ω—É –≤—ñ–¥–ø–æ–≤—ñ–¥—å –∫–æ—Ç–∏–∫ –æ—Ç—Ä–∏–º—É—î —Ä–∏–±–∫—É üêü</div>
      </div>
    </div>
    <div class="controls">
      <div class="levels" role="tablist" aria-label="–†—ñ–≤–Ω—ñ">
        <button class="btn active" data-level="1" role="tab" aria-selected="true">1‚Äì4 –∫–ª–∞—Å</button>
        <button class="btn" data-level="2" role="tab" aria-selected="false">5‚Äì7 –∫–ª–∞—Å</button>
        <button class="btn" data-level="3" role="tab" aria-selected="false">8‚Äì9 –∫–ª–∞—Å</button>
      </div>
    </div>
  </header>

  <main>
    <section class="card" id="tasks-area" aria-live="polite">
      <!-- Tasks injected here -->
    </section>

    <aside class="card sidebar" aria-hidden="false">
      <div style="display:flex;flex-direction:column;align-items:center;gap:10px;">
        <div class="cat-box" aria-hidden="true">
          <div id="catEmoji" class="cat" title="–ö–æ—Ç–∏–∫">üê±</div>
          <div class="fish-pool" id="fishPool" aria-hidden="true" title="–†–∏–±–∫–∏">
            <!-- fish icons -->
            <div class="fish" data-id="f1">üêü</div>
            <div class="fish" data-id="f2">üêü</div>
            <div class="fish" data-id="f3">üêü</div>
            <div class="fish" data-id="f4">üêü</div>
            <div class="fish" data-id="f5">üêü</div>
            <div class="fish" data-id="f6">üêü</div>
            <div class="fish" data-id="f7">üêü</div>
          </div>
        </div>

        <div class="fish-count" aria-live="polite" title="–ö—ñ–ª—å–∫—ñ—Å—Ç—å —Ä–∏–±–æ–∫ —É –∫–æ—Ç–∏–∫–∞">
          <div>–†–∏–±–æ–∫ —É –∫–æ—Ç–∏–∫–∞:</div>
          <div id="fishCount">0</div>
        </div>
        <div class="note">–ö–æ–∂–Ω–∞ –ø—Ä–∞–≤–∏–ª—å–Ω–∞ –≤—ñ–¥–ø–æ–≤—ñ–¥—å –¥–∞—î 1 —Ä–∏–±–∫—É. –°–ø—Ä–æ–±—É–π –≤—ñ–¥–ø–æ–≤—ñ—Å—Ç–∏ –Ω–∞ –≤—Å—ñ –ø–∏—Ç–∞–Ω–Ω—è! –†–∏–±–∫–∏ –∑–Ω–∏–∫–∞—Ç–∏–º—É—Ç—å —ñ–∑ –±–∞—Å–µ–π–Ω—É –ø–æ –æ–¥–Ω—ñ–π –ø—Ä–∏ –ø—Ä–∞–≤–∏–ª—å–Ω—ñ–π –≤—ñ–¥–ø–æ–≤—ñ–¥—ñ.</div>
      </div>
    </aside>
  </main>
</div>

<script>
(function(){
  /* ------------------------
     –î–∞–Ω—ñ: –∑–∞–≤–¥–∞–Ω–Ω—è –ø–æ —Ä—ñ–≤–Ω—è—Ö
     ------------------------ */
  const levels = {
    1: {
      title: "1‚Äì4 –∫–ª–∞—Å (–ª–µ–≥–∫–∏–π)",
      story: "–ö–æ—Ç–∏–∫ —Å–∏–¥—ñ–≤ –Ω–∞ –±–µ—Ä–µ–∑—ñ –π –ª–æ–≤–∏–≤ —Ä–∏–±—É. –î–æ–ø–æ–º–æ–∂–∏ –π–æ–º—É –∑ –≤–ø—Ä–∞–≤–∞–º–∏!",
      tasks: [
        // 1
        {
          id: "m1_1",
          subject: "–ú–∞—Ç–µ–º–∞—Ç–∏–∫–∞",
          type: "number",
          question: "–°–∫—ñ–ª—å–∫–∏ –±—É–¥–µ 5 + 7?",
          answer: 12,
          hint: ""
        },
        // 2
        {
          id: "m1_2",
          subject: "–ú–∞—Ç–µ–º–∞—Ç–∏–∫–∞",
          type: "number",
          question: "–ó–Ω–∞–π–¥–∏ —Ä—ñ–∑–Ω–∏—Ü—é: 15 ‚àí 8 = ?",
          answer: 7,
          hint: ""
        },
        // 3
        {
          id: "m1_3",
          subject: "–ú–∞—Ç–µ–º–∞—Ç–∏–∫–∞",
          type: "text",
          question: "–£ –∫–æ—Ç–∏–∫–∞ –±—É–ª–æ 4 —è–±–ª—É–∫–∞. –í—ñ–Ω –≤—ñ–¥–¥–∞–≤ 2. –°–∫—ñ–ª—å–∫–∏ —è–±–ª—É–∫ –∑–∞–ª–∏—à–∏–ª–æ—Å—è?",
          answer: "2",
          hint: ""
        },
        // 4
        {
          id: "u1_4",
          subject: "–£–∫—Ä–∞—ó–Ω—Å—å–∫–∞ –º–æ–≤–∞",
          type: "text",
          question: "–í—Å—Ç–∞–≤ –ø—Ä–æ–ø—É—â–µ–Ω–µ —Å–ª–æ–≤–æ: ¬´–ö–æ—Ç–∏–∫ ____ —Ä–∏–±—É –¥–µ–∫—ñ–ª—å–∫–∞ –¥–Ω—ñ–≤ —Ç–æ–º—É.¬ª (–ª–æ–≤–∏—Ç—å / –ª–æ–≤–∏–≤ / –ª–æ–≤–∏–ª–∞)",
          answer: "–ª–æ–≤–∏–≤",
          hint: ""
        },
        // 5
        {
          id: "u1_5",
          subject: "–£–∫—Ä–∞—ó–Ω—Å—å–∫–∞ –º–æ–≤–∞",
          type: "mc",
          question: "–í–∏–∑–Ω–∞—á —á–∞—Å—Ç–∏–Ω—É –º–æ–≤–∏: —Å–ª–æ–≤–æ '—à–≤–∏–¥–∫–æ' ‚Äî —Ü–µ ...",
          choices: ["—ñ–º–µ–Ω–Ω–∏–∫", "–ø—Ä–∏—Å–ª—ñ–≤–Ω–∏–∫", "–ø—Ä–∏–∫–º–µ—Ç–Ω–∏–∫"],
          answer: "–ø—Ä–∏—Å–ª—ñ–≤–Ω–∏–∫",
          hint: ""
        },
        // 6
        {
          id: "r1_6",
          subject: "–ß–∏—Ç–∞–Ω–Ω—è",
          type: "mc",
          question: "–ü—Ä–æ—á–∏—Ç–∞–π: ¬´–ö–æ—Ç–∏–∫ –ø–æ–±–∞—á–∏–≤ —Ä–∏–±–∫—É —ñ —Ç–∏—Ö–æ —Å—ñ–≤¬ª. –©–æ –∑—Ä–æ–±–∏–≤ –∫–æ—Ç–∏–∫?",
          choices: ["–ø–æ–±—ñ–≥", "—Ç–∏—Ö–æ —Å—ñ–≤", "—Å–ø—ñ–≤–∞–≤"],
          answer: "—Ç–∏—Ö–æ —Å—ñ–≤",
          hint: ""
        }
      ]
    },

    2: {
      title: "5‚Äì7 –∫–ª–∞—Å (—Å–µ—Ä–µ–¥–Ω—ñ–π)",
      story: "–ö–æ—Ç–∏–∫ –∫–ª–∏—á–µ –¥—Ä—É–≥–∞ ‚Äî —Ä–∞–∑–æ–º –ª–æ–≤–∏—Ç–∏ –±—ñ–ª—å—à–µ —Ä–∏–±. –ó–∞–≤–¥–∞–Ω–Ω—è —Ç—Ä–æ—Ö–∏ —Å–∫–ª–∞–¥–Ω—ñ—à—ñ.",
      tasks: [
        // 1 –ø—Ä–æ–ø–æ—Ä—Ü—ñ—è
        {
          id: "m2_1",
          subject: "–ú–∞—Ç–µ–º–∞—Ç–∏–∫–∞",
          type: "text",
          question: "–ü—Ä–æ–ø–æ—Ä—Ü—ñ—è: –Ø–∫—â–æ 3 —Ä–∏–±–∫–∏ –≤–∞–∂–∞—Ç—å 6 –∫–≥, —Å–∫—ñ–ª—å–∫–∏ –≤–∞–∂–∏—Ç–∏–º–µ 1 —Ä–∏–±–∫–∞?",
          answer: "2",
          hint: ""
        },
        // 2 —Ä—ñ–≤–Ω—è–Ω–Ω—è
        {
          id: "m2_2",
          subject: "–ú–∞—Ç–µ–º–∞—Ç–∏–∫–∞",
          type: "number",
          question: "–†–æ–∑–≤'—è–∂–∏: 2x + 5 = 21. –ó–Ω–∞–π–¥–∏ x.",
          answer: 8,
          hint: ""
        },
        // 3 —Å–µ—Ä–µ–¥–Ω—î –∞—Ä–∏—Ñ–º–µ—Ç–∏—á–Ω–µ
        {
          id: "m2_3",
          subject: "–ú–∞—Ç–µ–º–∞—Ç–∏–∫–∞",
          type: "number",
          question: "–ó–Ω–∞–π–¥–∏ —Å–µ—Ä–µ–¥–Ω—î –∞—Ä–∏—Ñ–º–µ—Ç–∏—á–Ω–µ —á–∏—Å–µ–ª 6, 9, 12.",
          answer: 9,
          hint: ""
        },
        // 4 —Ç–∏–ø —Ä–µ—á–µ–Ω–Ω—è
        {
          id: "u2_4",
          subject: "–£–∫—Ä–∞—ó–Ω—Å—å–∫–∞",
          type: "mc",
          question: "–í–∏–∑–Ω–∞—á —Ç–∏–ø —Ä–µ—á–µ–Ω–Ω—è: '–ö–æ—Ç–∏–∫ –ª–æ–≤–∏—Ç—å —Ä–∏–±–∫—É –∫–æ–∂–Ω–æ–≥–æ —Ä–∞–Ω–∫—É.' –¶–µ ‚Äî ...",
          choices: ["–ø–∏—Ç–∞–ª—å–Ω–µ", "—Ä–æ–∑–ø–æ–≤—ñ–¥–Ω–µ", "—Å–ø–æ–Ω—É–∫–∞–ª—å–Ω–µ"],
          answer: "—Ä–æ–∑–ø–æ–≤—ñ–¥–Ω–µ",
          hint: "–í–∏—Å–ª–æ–≤–ª—é—î –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è."
        },
        // 5 –ø—ñ–¥–º–µ—Ç —ñ –ø—Ä–∏—Å—É–¥–æ–∫
        {
          id: "u2_5",
          subject: "–£–∫—Ä–∞—ó–Ω—Å—å–∫–∞",
          type: "text",
          question: "–ó–Ω–∞–π–¥–∏ –ø—ñ–¥–º–µ—Ç —Ç–∞ –ø—Ä–∏—Å—É–¥–æ–∫ —É —Ä–µ—á–µ–Ω–Ω—ñ: '–ö–æ—Ç–∏–∫ –ª–æ–≤–∏—Ç—å —Ä–∏–±—É.' –í–≤–µ–¥–∏ —á–µ—Ä–µ–∑ –∫–æ–º—É: –ø—ñ–¥–º–µ—Ç,–ø—Ä–∏—Å—É–¥–æ–∫",
          answer: "–ö–æ—Ç–∏–∫,–ª–æ–≤–∏—Ç—å",
          hint: ""
        },
        // 6 —á–∏—Ç–∞–Ω–Ω—è - –ø—ñ–¥–∫—Ä–µ—Å–ª–∏ –ø—Ä–∏–∫–º–µ—Ç–Ω–∏–∫–∏ (–≤–≤–µ—Å—Ç–∏ —á–µ—Ä–µ–∑ –∫–æ–º—É)
        {
          id: "r2_6",
          subject: "–ß–∏—Ç–∞–Ω–Ω—è",
          type: "text",
          question: "–£ —Ä–µ—á–µ–Ω–Ω—ñ '–®–≤–∏–¥–∫–∏–π —Å—ñ—Ä–∏–π –∫—ñ—Ç —Ç–∏—Ö–æ —Å–∏–¥—ñ–≤ –Ω–∞ —Ç–µ–ø–ª–æ–º—É –ø—ñ–¥–≤—ñ–∫–æ–Ω–Ω—ñ.' –ø—ñ–¥–∫—Ä–µ—Å–ª–∏ –≤—Å—ñ –ø—Ä–∏–∫–º–µ—Ç–Ω–∏–∫–∏ (–≤–≤–µ–¥–∏ —á–µ—Ä–µ–∑ –∫–æ–º—É).",
          answerVariants: ["—à–≤–∏–¥–∫–∏–π,—Å—ñ—Ä–∏–π,—Ç–µ–ø–ª–æ–º—É","—à–≤–∏–¥–∫–∏–π,—Å—ñ—Ä–∏–π,—Ç–µ–ø–ª–∏–π","—à–≤–∏–¥–∫–∏–π,—Ç–µ–ø–ª–æ–º—É,—Å—ñ—Ä–∏–π", "—Å—ñ—Ä–∏–π,—à–≤–∏–¥–∫–∏–π,—Ç–µ–ø–ª–æ–º—É","—Å—ñ—Ä–∏–π,—Ç–µ–ø–ª–æ–º—É,—à–≤–∏–¥–∫–∏–π","—Ç–µ–ø–ª–æ–º—É,—à–≤–∏–¥–∫–∏–π,—Å—ñ—Ä–∏–π","—Ç–µ–ø–ª–∏–π,—à–≤–∏–¥–∫–∏–π,—Å—ñ—Ä–∏–π","—Ç–µ–ø–ª–∏–π,—Å—ñ—Ä–∏–π,—à–≤–∏–¥–∫–∏–π"],
          hint: ""
        }
      ]
    },

    3: {
      title: "8‚Äì9 –∫–ª–∞—Å (—Å–∫–ª–∞–¥–Ω–∏–π)",
      story: "–ö–æ—Ç–∏–∫ –≤–∏–≤—á–∞—î —Ç–µ—á—ñ—ó —Ä—ñ—á–∫–∏, —Ä–æ–±–∏—Ç—å —Å–∫–ª–∞–¥–Ω—ñ—à—ñ –≤–ø—Ä–∞–≤–∏. –ü–æ—Ç—Ä—ñ–±–Ω–æ –¥—É–º–∞—Ç–∏ —É–≤–∞–∂–Ω–æ.",
      tasks: [
        // 1 —Å–∫–ª–∞–¥–Ω—ñ —Ä—ñ–≤–Ω—è–Ω–Ω—è (–≤–∏–∑–Ω–∞—á–∏–º–æ –ø—Ä–∏–∫–ª–∞–¥)
        {
          id: "m3_1",
          subject: "–ú–∞—Ç–µ–º–∞—Ç–∏–∫–∞",
          type: "text",
          question: "–†–æ–∑–≤'—è–∂–∏: 5—Ö + 45 = 125",
            answer: "16",
            hint: ""
        },
        // 2 —Å–∏—Å—Ç–µ–º–∞ –∞–±–æ —Å–∫–ª–∞–¥–Ω–µ —Ä—ñ–≤–Ω—è–Ω–Ω—è
        {
          id: "m3_2",
          subject: "–ú–∞—Ç–µ–º–∞—Ç–∏–∫–∞",
          type: "text",
          question: "–†–æ–∑–≤'—è–∂–∏ —Å–∏—Å—Ç–µ–º—É: x + y = 5, x - y = 1. –í–≤–µ–¥–∏ —è–∫ x=?,y=? (–Ω–∞–ø—Ä–∏–∫–ª–∞–¥ x=6,y=7).",
          answer: "x=3,y=2",
          hint: ""
        },
        // 3 –≥–µ–æ–º–µ—Ç—Ä—ñ—è: –ø–µ—Ä–∏–º–µ—Ç—Ä —Ç—Ä–∏–∫—É—Ç–Ω–∏–∫–∞
        {
          id: "g3_3",
          subject: "–ì–µ–æ–º–µ—Ç—Ä—ñ—è",
          type: "number",
          question: "–¢—Ä–∏–∫—É—Ç–Ω–∏–∫ –∑—ñ —Å—Ç–æ—Ä–æ–Ω–∞–º–∏ 7 —Å–º, 8 —Å–º —ñ 9 —Å–º. –ó–Ω–∞–π–¥–∏ –π–æ–≥–æ –ø–µ—Ä–∏–º–µ—Ç—Ä (–≤ —Å–º).",
          answer: 24,
          hint: ""
        },
        // 4 —É–∫—Ä–∞—ó–Ω—Å—å–∫–∞: —Ä–æ–∑–¥—ñ–ª–æ–≤—ñ –∑–Ω–∞–∫–∏
        {
          id: "u3_4",
          subject: "–£–∫—Ä–∞—ó–Ω—Å—å–∫–∞",
          type: "text",
          question: "–í—Å—Ç–∞–≤ —Ä–æ–∑–¥—ñ–ª–æ–≤—ñ –∑–Ω–∞–∫–∏ —É —Ä–µ—á–µ–Ω–Ω—è: –ö–æ—Ç–∏–∫ —è–∫–∏–π –ª–æ–≤–∏–≤ —Ä–∏–±—É –ø–æ—á—É–≤ —à—É–º —É –∫—É—â–∞—Ö",
          answer: "–ö–æ—Ç–∏–∫, —è–∫–∏–π –ª–æ–≤–∏–≤ —Ä–∏–±—É, –ø–æ—á—É–≤ —à—É–º —É –∫—É—â–∞—Ö.",
          hint: ""
        },
        // 5 —á–∏—Ç–∞–Ω–Ω—è: –∑–Ω–∞–π—Ç–∏ –ø—ñ–¥–º–µ—Ç —ñ –ø—Ä–∏—Å—É–¥–æ–∫
        {
          id: "r3_5",
          subject: "–ß–∏—Ç–∞–Ω–Ω—è",
          type: "text",
          question: "–£ —Ä–µ—á–µ–Ω–Ω—ñ '–¢–∏—Ö–æ–≥–æ —Ä–∞–Ω–∫—É –∫—ñ—Ç –ø—Ä–æ–∫–∏–Ω—É–≤—Å—è —ñ –ø—ñ—à–æ–≤ –¥–æ —Ä—ñ—á–∫–∏.' –∑–Ω–∞–π–¥–∏ –ø—ñ–¥–º–µ—Ç —ñ –ø—Ä–∏—Å—É–¥–æ–∫ (—á–µ—Ä–µ–∑ –∫–æ–º—É).",
          answerVariants: ["–∫—ñ—Ç,–ø—Ä–æ–∫–∏–Ω—É–≤—Å—è, –ø—ñ—à–æ–≤","–∫—ñ—Ç –ø—Ä–æ–∫–∏–Ω—É–≤—Å—è —ñ –ø—ñ—à–æ–≤", "–∫—ñ—Ç,–ø—Ä–æ–∫–∏–Ω—É–≤—Å—è —ñ –ø—ñ—à–æ–≤", "–∫—ñ—Ç,–ø—Ä–æ–∫–∏–Ω—É–≤—Å—è,–ø—ñ—à–æ–≤", "–∫—ñ—Ç,–ø—Ä–æ–∫–∏–Ω—É–≤—Å—è", "–∫—ñ—Ç,–ø—ñ—à–æ–≤"],
          hint: ""
        },
        // 6 –¥–æ–¥–∞—Ç–∫–æ–≤–µ –∑–∞–≤–¥–∞–Ω–Ω—è (–∞–ª–≥–µ–±—Ä–∞/–∞–Ω–∞–ª—ñ–∑) ‚Äî —â–æ–± –±—É–ª–æ 6 –∑–∞–≤–¥–∞–Ω—å
        {
          id: "m3_6",
          subject: "–ú–∞—Ç–µ–º–∞—Ç–∏–∫–∞",
          type: "number",
          question: "–ó–Ω–∞–π–¥–∏ x: 3x + 5 = 20",
          answer: 5,
          hint: ""
        }
      ]
    }
  };

  /* ------------------------
     –°—Ç–∞–Ω –ø—Ä–æ–≥—Ä–∞–º–∏
     ------------------------ */
  let currentLevel = 1;
  let fishCount = 0;
  const awarded = new Set(); // —â–æ–± –Ω–µ –Ω–∞—Ä–∞—Ö–æ–≤—É–≤–∞—Ç–∏ —Ä–∏–±–∫–∏ –∫—ñ–ª—å–∫–∞ —Ä–∞–∑—ñ–≤ –¥–ª—è –æ–¥–Ω–æ–≥–æ –∑–∞–≤–¥–∞–Ω–Ω—è

  /* ------------------------
     DOM –ø–æ—Å–∏–ª–∞–Ω–Ω—è
     ------------------------ */
  const tasksArea = document.getElementById('tasks-area');
  const btns = document.querySelectorAll('.levels .btn');
  const fishCountEl = document.getElementById('fishCount');
  const fishPool = document.getElementById('fishPool');
  const catEmoji = document.getElementById('catEmoji');

  /* ------------------------
     –ì–æ–ª–æ–≤–Ω—ñ —Ñ—É–Ω–∫—Ü—ñ—ó
     ------------------------ */

  function renderLevel(levelId){
    const data = levels[levelId];
    tasksArea.innerHTML = '';

    const header = document.createElement('div');
    header.className = 'level-header';
    header.innerHTML = `<div>
      <h2 style="margin:0">${data.title}</h2>
      <div class="small-muted" style="margin-top:6px">${data.story}</div>
    </div>
    <div style="text-align:right;">
      <div class="small-muted">–ó–∞–≤–¥–∞–Ω—å: ${data.tasks.length}</div>
      <div style="height:6px"></div>
    </div>`;
    tasksArea.appendChild(header);
    const list = document.createElement('div');

    data.tasks.forEach((task, idx) => {
      const t = document.createElement('div');
      t.className = 'task';
      t.id = task.id;

      const qTitle = document.createElement('h3');
      qTitle.innerHTML = `<span>${task.subject}</span><small style="font-weight:600;color:var(--muted);font-size:12px"> #${idx+1}</small>`;
      t.appendChild(qTitle);

      const q = document.createElement('p');
      q.innerHTML = `<strong>${task.question}</strong>`;
      t.appendChild(q);

      const inputArea = document.createElement('div');

      if(task.type === 'mc'){
        task.choices.forEach((c, cidx) => {
          const id = `${task.id}_opt_${cidx}`;
          const label = document.createElement('label');
          label.style.display='block';
          label.style.marginBottom='6px';
          label.innerHTML = `<input type="radio" name="${task.id}" value="${c}" id="${id}"> <span style="margin-left:8px">${c}</span>`;
          inputArea.appendChild(label);
        });
      } else if (task.type === 'number') {
        const inp = document.createElement('input');
        inp.type = 'number';
        inp.name = task.id;
        inp.inputMode = 'numeric';
        inp.placeholder = '–í–≤–µ–¥–∏ —á–∏—Å–ª–æ...';
        inputArea.appendChild(inp);
      } else { // text
        const inp = document.createElement('input');
        inp.type = 'text';
        inp.name = task.id;
        inp.placeholder = '–í–≤–µ–¥–∏ –≤—ñ–¥–ø–æ–≤—ñ–¥—å...';
        inputArea.appendChild(inp);
      }

      const controls = document.createElement('div');
      controls.style.display = 'flex';
      controls.style.gap = '8px';
      controls.style.alignItems = 'center';

      const checkBtn = document.createElement('button');
      checkBtn.className = 'check';
      checkBtn.textContent = '–ü–µ—Ä–µ–≤—ñ—Ä–∏—Ç–∏';
      checkBtn.onclick = () => checkAnswer(task);
      controls.appendChild(checkBtn);

      const hint = document.createElement('div');
      hint.className = 'hint';
      hint.textContent = task.hint || '';
      inputArea.appendChild(controls);
      inputArea.appendChild(hint);

      const result = document.createElement('div');
      result.className = 'result';
      inputArea.appendChild(result);

      t.appendChild(inputArea);
      list.appendChild(t);
    });

    tasksArea.appendChild(list);

    // reset fish visibility if needed
    Array.from(document.querySelectorAll('.fish')).forEach(f => { f.style.visibility = 'visible'; f.classList.remove('fly'); });
  }

  function normalize(s){
    if(s === null || s === undefined) return '';
    return String(s).trim().replace(/\s+/g,' ').replace(/[¬´¬ª‚Äû‚Äú]/g,'"').replace(/\u200B/g,'');
  }

  function normalizeLower(s){
    return normalize(s).toLowerCase();
  }

  function parseListInput(user){
    // split by comma or semicolon and trim
    return user.split(/[;,]+/).map(x=>normalizeLower(x)).filter(Boolean);
  }

  function checkAnswer(task){
    const el = document.getElementById(task.id);
    const resultEl = el.querySelector('.result');

    // if already awarded for this task, do not award again
    if(awarded.has(task.id)){
      resultEl.innerHTML = `<span class="right">–í–∂–µ –ø—Ä–∞–≤–∏–ª—å–Ω–æ ‚úÖ –†–∏–±–∫–∞ –≤–∂–µ –Ω–∞ —Ä–∞—Ö—É–Ω–∫—É.</span>`;
      return;
    }

    let userVal = '';
    if(task.type === 'mc'){
      const sel = el.querySelector(`input[name="${task.id}"]:checked`);
      userVal = sel ? sel.value : '';
    } else {
      const input = el.querySelector(`input[name="${task.id}"]`);
      userVal = input ? input.value : '';
    }

    // evaluate correctness
    let correct = false;

    if(task.type === 'number'){
      const num = Number(userVal);
      correct = (Number.isFinite(num) && Number(task.answer) === num);
    } else if (task.type === 'mc'){
      correct = normalizeLower(userVal) === normalizeLower(task.answer);
    } else { // text
      if(task.answerVariants){
        const normalized = normalizeLower(userVal);
        correct = task.answerVariants.some(v => normalized === normalizeLower(v));
      } else if (typeof task.answer === 'string' && task.answer.includes(',')){
        // some answers are "a,b" (like "–ö–æ—Ç–∏–∫,–ª–æ–≤–∏—Ç—å") - normalize order-insensitive
        const expected = parseListInput(task.answer);
        const given = parseListInput(userVal || '');
        // check that given contains at least expected items (order-insensitive)
        correct = expected.length > 0 && expected.every(e => given.includes(e));
      } else {
        correct = normalizeLower(userVal) === normalizeLower(task.answer);
      }
    }

    if(correct){
      resultEl.innerHTML = `<span class="right">–ü—Ä–∞–≤–∏–ª—å–Ω–æ! –ö–æ—Ç–∏–∫ –æ—Ç—Ä–∏–º—É—î —Ä–∏–±–∫—É üêü</span>`;
      // mark awarded
      awarded.add(task.id);
      // disable check button
      const btn = el.querySelector('.check');
      if(btn){ btn.disabled = true; btn.style.opacity = '.6'; }
      giveFishAnimation();
    } else {
      resultEl.innerHTML = `<span class="wrong">–ù–µ–ø—Ä–∞–≤–∏–ª—å–Ω–æ. –°–ø—Ä–æ–±—É–π —â–µ.</span>`;
      // small shake animation for wrong (CSS-free approach)
      resultEl.animate([{ transform: 'translateX(0)' }, { transform: 'translateX(-6px)' }, { transform: 'translateX(6px)' }, { transform: 'translateX(0)' }], { duration: 300 });
    }
  }

  function giveFishAnimation(){
    const fishes = Array.from(document.querySelectorAll('.fish'));
    const available = fishes.find(f => !f.classList.contains('fly') && f.style.visibility!=='hidden');
    if(!available){
      // no visible fish; just increment count and pulse cat
      fishCount++;
      updateFishCount();
      catEmoji.style.transform = 'translateY(-6px) scale(1.06)';
      setTimeout(()=> catEmoji.style.transform = 'translateY(8px)', 350);
      return;
    }
    // animate one fish flying
    available.classList.add('fly');
    setTimeout(()=>{
      available.style.visibility = 'hidden';
      available.classList.remove('fly');
      fishCount++;
      updateFishCount();
      catEmoji.style.transform = 'translateY(-8px) scale(1.08)';
      setTimeout(()=> catEmoji.style.transform = 'translateY(8px)', 420);
    }, 920);
  }

  function updateFishCount(){
    fishCountEl.textContent = fishCount;
  }

  // attach level buttons
  btns.forEach(b => {
    b.addEventListener('click', () => {
      btns.forEach(x => { x.classList.remove('active'); x.setAttribute('aria-selected','false'); });
      b.classList.add('active');
      b.setAttribute('aria-selected','true');
      currentLevel = Number(b.dataset.level);
      renderLevel(currentLevel);
    });
  });

  // initial render
  renderLevel(currentLevel);

  // keyboard: Enter in inputs triggers check for that task
  document.addEventListener('keydown', function(e){
    if(e.key === 'Enter'){
      const active = document.activeElement;
      if(active && (active.tagName === 'INPUT' || active.tagName === 'TEXTAREA')){
        // find nearest task container
        const taskDiv = active.closest('.task');
        if(taskDiv){
          const id = taskDiv.id;
          // find the task object
          const level = levels[currentLevel];
          if(!level) return;
          const task = level.tasks.find(t => t.id === id);
          if(task) checkAnswer(task);
        }
      }
    }
  });

  // allow clicking fish to preview animation (fun)
  Array.from(document.querySelectorAll('.fish')).forEach(f=>{
    f.addEventListener('click', ()=> {
      if(!f.classList.contains('fly') && f.style.visibility!=='hidden'){
        f.classList.add('fly');
        setTimeout(()=> { f.classList.remove('fly'); }, 900);
      }
    });
  });

})();
</script>
</body>
</html>
